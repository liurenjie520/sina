<!DOCTYPE html>
<html>

	<head>
		<meta charset="UTF-8">
		<title></title>
	</head>
	<script src="./laydate.js">
	</script>
	<script src="./jquery-3.6.0.min.js" type="text/javascript">
	</script>
	<script>
		function bh() {
			//$('table tr:not(:first)').remove();
			var len = $('table tr').length;
			for(var i = 0; i <= len; i++) {
				$('table tr:eq(' + i + ') td:first').text(i);
			}

		}
	</script>
	<script type="text/javascript">
		function runtime() {
			// 初始时间，日/月/年 时:分:秒
			X = new Date("01/25/2022 8:32:00");
			Y = new Date();
			T = (Y.getTime() - X.getTime());
			M = 24 * 60 * 60 * 1000;
			a = T / M;
			A = Math.floor(a);
			b = (a - A) * 24;
			B = Math.floor(b);
			c = (b - B) * 60;
			C = Math.floor((b - B) * 60);
			D = Math.floor((c - C) * 60);
			//信息写入到DIV中
			span.innerHTML = "本站勉强运行: " + A + "天" + B + "小时" + C + "分" + D + "秒"
		}
		setInterval(runtime, 1000);
	</script>

	<script>
		//执行一个laydate实例
		laydate.render({
			elem: '#laydate' //指定元素
				//,type: 'datetime'
				,
			trigger: 'click',
			format: 'yyyy/MM/dd'

		});

		laydate.render({
			elem: '#jk' //指定元素
				//,type: 'datetime'
				,
			trigger: 'click',
			type: 'time',
			format: 'HH'

		});
	</script>

	<body style="background-color:#FFF0CD;">
		<h2>
   RS博物馆
    </h2>
		<hr>
		<div class="busuanzi-count">
			<script async="" src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
			<span class="site-uv">
      <i class="fa fa-user"></i>
      访问用户： <span class="busuanzi-value" id="busuanzi_value_site_uv"></span> 人
			</span>
			<div class="powered-by"></div>
			<span class="site-uv">
      <i class="fa fa-eye"></i>
      访问次数： <span class="busuanzi-value" id="busuanzi_value_site_pv"></span> 次
			</span>
			<div><span id="span">Loading...</span>

			</div>
		</div>
		<br>
		<h5>说明：1.先点击【当前时间生成url】，再点【当前时间的热搜】<br />2.先点击【时间控件，选择时间，全部必选】，再点【自定义时间生成url】，最后再点【自定义时间的热搜】<br />3.时间控件不兼容手机，自行输入：2022/01/25和02<br />4.需科学上网</h5>

		<h5>数据来源：github</h5>

		<form name="form1" method="post" action="">
			<label>
    <input type="text" name="textfield" id="textfield" style="width:560px;height:40px;background-color:#FFF0CD">
    <input type="button" style="width:150px;height:40px;background-color:#FFF0CD" name="button2" id="button2" value="当前时间生成url" onclick="javascript: void var2pass();">
    <input type="button" style="width:150px;height:40px;background-color:#FFF0CD" name="button" id="button" value="当前时间的热搜" onclick="javascript: void show(textfield.value);">
   
    
    
    </label>
			<!-- 绑定onclick事件 -->
			<label>
   <br />
      </label>
			<!-- 绑定onclick事件 -->
			<label>
				年月日，例如：2022/01/25 <input type="text" id="laydate" style="width:80px;height:40px;background-color:#FFF0CD"/>
    日，例如：03<input type="text" id="jk" style="width:80px;height:40px;background-color:#FFF0CD"/>
    <input type="text" id="createurl" style="width:560px;height:40px;background-color:#FFF0CD"/>
    
     <input type="button" name="button3" style="width:150px;height:40px;background-color:#FFF0CD" id="button3" value="自定义时间生成url" onclick="javascript: void gettime();">
     <input type="button" name="button" style="width:150px;height:40px;background-color:#FFF0CD" id="button" value="自定义时间的热搜" onclick="javascript: void show(createurl.value);">
 <br /><br />
    <input type="text" id="createurl2" style="width:560px;height:40px;background-color:#FFF0CD"/>
    
        
 <input type="button" name="button5" style="width:150px;height:40px;background-color:#FFF0CD" id="button5" value="自定义时间csv生成url" onclick="javascript: void gettime2();">
    <input type="button" name="button6" style="width:150px;height:40px;background-color:#FFF0CD" id="button6" value="csv下载" onclick="javascript: void xiazai(createurl2.value);">

    </label>
		</form>

		<!--<table width=500 border=2 id="firstTabOverall">
			<tr>
				<td width=250>序号</td>
				<td width=250>项目</td>
				<td width=250>项目</td>
			</tr>
			<tr >
				<td></td>
				<td id="rs">255</td>
				<td id="hot">255</td>
			</tr>
		</table>
    -->
		<table width="600" border="1" cellspacing="0">
			<thead>
				<tr>
					<th>排行</th>
					<th>名称</th>
					<th>热度值</th>

				</tr>
			</thead>
			<tbody id="tbMain"></tbody>

	</body>
	<script src="./layer/layer.js"></script>
	<script src="./jquery-3.6.0.min.js"></script>
	<script type="text/javascript">
		var str_1 = '';
		//全局配置
		var shuju = ''
		$.ajaxSetup({
			layerIndex: -1, //保存当前请求对应的提示框index,用于后面关闭使用
			//在请求显示提示框
			beforeSend: function(jqXHR, settings) {
				this.layerIndex = layer.load(1);
			},

			complete: function() {
				//请求完毕后（成功），关闭提示框
				if(shuju != '') {
					layer.close(this.layerIndex);
					//请求完毕后（失败），弹出错误信息，关闭提示框
				} else {
					layer.alert('数据请求失败，请后再试!');
					layer.close(this.layerIndex);
				}

			},
			//请求失败时，弹出错误信息，关闭提示框
			error: function(jqXHR, status, e) {
				layer.alert('数据请求失败，请后再试!');
				layer.close(this.layerIndex);
			}
		});

		function var2pass() {
			var mdate = new Date();
			//  	var c=mdate.toLocaleString()
			//  	var f=c.slice(0,10)

			d = String(mdate.getDate().toString().padStart(2, '0'))
			m = String((mdate.getMonth() + 1).toString().padStart(2, '0'))
			y = String(mdate.getFullYear())
			h = String(mdate.getHours().toString().padStart(2, '0'))
			lujing = y + '/' + m + '/' + d
			wenjian = '/' + y + m + d + h + '.json'
			zifu = "https://raw.githubusercontent.com/liurenjie520/weibohot/main/" + lujing
			urll = zifu + wenjian
			str_1 = urll.replace(/\s*/g, "");
			console.log(str_1)
			document.getElementById('textfield').value = str_1;
		}

		function gettime() {

			var gettime = document.getElementById('laydate').value
			var date = new Date(gettime)
			d = String(date.getDate().toString().padStart(2, '0'))
			m = String((date.getMonth() + 1).toString().padStart(2, '0'))
			y = String(date.getFullYear())
			var hour = document.getElementById('jk').value
			lujing = y + '/' + m + '/' + d
			wenjian = '/' + y + m + d + hour + '.json'
			zifu = "https://raw.githubusercontent.com/liurenjie520/weibohot/main/" + lujing
			urll = zifu + wenjian
			str_2 = urll.replace(/\s*/g, "")
			console.log(str_2)
			document.getElementById('createurl').value = str_2;

		}

		function gettime2() {

			var gettime = document.getElementById('laydate').value
			var date = new Date(gettime)
			d = String(date.getDate().toString().padStart(2, '0'))
			m = String((date.getMonth() + 1).toString().padStart(2, '0'))
			y = String(date.getFullYear())
			var hour = document.getElementById('jk').value
			lujing = y + '/' + m + '/' + d
			wenjian = '/' + y + '年' + m + '月' + d + '日的热搜' + '.csv'
			zifu = "https://raw.githubusercontent.com/liurenjie520/weibohot/main/" + lujing
			urll = zifu + wenjian
			str_2 = urll.replace(/\s*/g, "")
			console.log(str_2)
			document.getElementById('createurl2').value = str_2;

		}

		function xiazai(ddd) {
			//			url: ddd, //json文件位置
			window.open(ddd);
		}

		function show(dd) {
			if(shuju != '') {
				layer.alert('已生成数据！请刷新页面再点击按钮！');

			} else {

				$.ajax({
					url: dd, //json文件位置
					type: "GET", //请求方式为get
					dataType: "json", //返回数据格式为json
					success: function(data) { //请求成功完成后要执行的方法 
						//each循环 使用$.each方法遍历返回的数据date
						$.each(data, function(i, item) {

							//                  var str =  '<table width=500 border=2><tr><td width=250>序号</td><td width=250>项目</td><td width=250>项目</td></tr><tr><td></td><td>'+ i +'</td><td>'+ item.hot + '</td></tr></table>'
							//;                   
							//                  document.write(str);

							var biaoti = i
							console.log(biaoti)
							var hot = item.hot

							//                  document.getElementById('rs').innerHTML= biaoti;
							//                  var tbody = document.getElementById('tbMain');
							//                  var row = document.createElement('tr');
							//                  var idCell = document.createElement('td');
							//                  idCell.innerHTML = biaoti;
							//                  var tbody = document.getElementById("tbMain");
							//                  tbody.appendChild(row)

							var tbody = document.getElementById('tbMain');

							//						for(var j = 0; j < item.length; j++) { //遍历一下json数据
							var trow = getDataRow(); //定义一个方法,返回tr数据
							tbody.appendChild(trow);
							//						}

							function getDataRow() {

								var row = document.createElement('tr'); //创建行

								var idCell = document.createElement('td'); //创建第一列id
								idCell.innerHTML = bh(); //填充数据
								row.appendChild(idCell); //加入行  ，下面类似
								var nameCell = document.createElement('td'); //创建第二列name
								nameCell.innerHTML = biaoti;
								row.appendChild(nameCell);

								var jobCell = document.createElement('td'); //创建第三列job
								jobCell.innerHTML = hot;
								row.appendChild(jobCell);
								shuju = row
								return row; //返回tr数据	
							}

						})
					}
				})

			}
		}
	</script>
<script>
	var str = '欢迎来到热搜博物馆！\n八点不会生成数据，已知的bug...不知道解决...\n本站随缘维护！';
console.log("%c"+str,"font-size:20px;");
//     console.info('欢迎来到热搜博物馆！\n本站随缘维护！')
</script>

</html>
